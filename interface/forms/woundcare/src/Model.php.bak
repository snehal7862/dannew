<?php

/**
 *   package OpenEMR
 *   link    https://www.open-emr.org
 *   author  Sherwin Gaddis <sherwingaddis@gmail.com>
 *   Copyright (c) 2022.
 */

namespace WoundCare;

require_once dirname(__DIR__, 3) . "/globals.php";


/**
 * use this class for the database layer
 * all database calls should have a method here
 */

class Model
{
    private $data;

    public function __construct()
    {
        /*
         * future use I hope
         */
    }

    /**
     * @return false|string
     */
    public function getData(): bool|string
    {
        return $this->data;
    }

    public function setData($data)
    {
        $this->data = $data;
        return $this->data;
    }

    public function getFormId()
    {
        $res2 = sqlStatement("SELECT MAX(id) as largestId FROM `form_care_plan`");
        $getMaxid = sqlFetchArray($res2);
        if ($getMaxid['largestId']) {
            return $getMaxid['largestId'] + 1;
        } else {
            return 1;
        }
    }

    public function storeProgressNote($newid)
    {
        sqlStatement("INSERT INTO `form_woundcare` SET " .
            "id = ?, " .
            "date = ?, " .
            "pid = ?, " .
            "encounter = ?, " .
            "user = ?, " .
            "groupname = ?, " .
            "authorized = ?, " .
            "activity = ?, " .
            "json_data = ? ",
        [
          $newid,
            'NOW()',
            $_SESSION['pid'],
            $_SESSION['encounter'],
            $_SESSION['authUser'],
            'default',
            $_SESSION['userauthorized'],
            1,
            self::getData()
        ]
        );
    }

    public function getTodaysBilling(): array
    {
        $sqlStatement = "SELECT * FROM billing WHERE encounter = ?";
        $billing = sqlStatement($sqlStatement, [$_SESSION['encounter']]);
        $billing_data = [];
        while ($row = sqlFetchArray($billing)) {
            if (is_array(@$row)) {
                array_push($billing_data, $row);
            }
        }

        echo (json_encode($billing_data));
        exit();
    }
}
